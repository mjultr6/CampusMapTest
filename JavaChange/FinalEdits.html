<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<style>
html, body {width:100%; height:100%; margin:0; padding:0;}
#map {position:absolute; top:0; bottom:0; left:0; right:0; touch-action: pan-x pan-y;}
#passWrapper {
  position: absolute;
  top: 10px;
  left: 50px;
  z-index: 1000;
  pointer-events: auto !important;
}
#passSelect {
  padding: 6px 12px;
  border: 1px solid #ced4da;
  border-radius: 0.375rem;
  background: white;
  min-width: 220px;
}
</style>
</head>
<body>
<div id="passWrapper">
<select id="passSelect">
<option value="" selected>Select Parking Pass</option>
<option value="Green">South Housing (Green)</option>
<option value="Yellow">Clark Murphy Complex (Yellow)</option>
<option value="BabyBlue">North Village/Bell Tower(Baby Blue)</option>
<option value="Silver">Silver/Senior (Silver)</option>
<option value="Orange">Commuter/Graduate/OLLI (Orange)</option>
<option value="Purple">Faculty/Staff (Purple)</option>
<option value="All">All Lots (Pink)</option>
</select>
</div>
<div id="map"></div>
<script>
const map = L.map('map', {
center: [34.9275, -82.4401],
zoom: 16,
maxBounds: [[34.91, -82.46], [34.94, -82.42]]
});
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
minZoom: 14, maxZoom: 19,
attribution: 'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

let baseLayer = null;
let highlightLayer = null;
let geoData = null;

const passNames = {
Green: 'South Housing (Green)',
Yellow: 'Clark Murphy Complex (Yellow)',
BabyBlue: 'North Village/Bell Tower(Baby Blue)',
Silver: 'Silver/Senior (Silver)',
Orange: 'Commuter/Graduate/OLLI (Orange)',
Purple: 'Faculty/Staff (Purple)'
};
const passColors = {
Green: '#00cc00',
Yellow: '#ffcc00',
BabyBlue: '#00a9f9',
Silver: '#808080',
Orange: '#ff8c00',
Purple: '#9932cc',
All: '#FA9BCF'
};

fetch('https://mjultr6.github.io/CampusMapTest/export.geojson')
.then(res => res.json())
.then(data => {
geoData = data;
baseLayer = L.geoJSON(data, {
style: {color: "#3388ff", weight: 2, fillColor: "#3388ff", fillOpacity: 0.2},
onEachFeature: (f, l) => {
let popup = '';
const tags = f.properties.tags || {};
if (tags.name) popup += `Name: ${tags.name}<br>`;
if (tags.capacity) popup += `Spots: ${tags.capacity}<br>`;
if (popup) l.bindPopup(popup);
}
});
});

document.getElementById('passSelect').addEventListener('change', e => {
const val = e.target.value;
if (highlightLayer) highlightLayer.remove();
if (baseLayer) baseLayer.remove();

if (!val || !geoData) return;

if (val === 'All') {
  highlightLayer = L.geoJSON(geoData, {
    style: {color: '#FA9BCF', weight: 3, opacity: 0.9, fillColor: '#FA9BCF', fillOpacity: 0.35},
    onEachFeature: (f, l) => {
      const passes = f.properties.pass || [];
      const allowed = passes.map(p => passNames[p] || p).filter(Boolean).join(', ') || 'None';
      const name = f.properties.tags?.name || f.properties['@id'] || 'Unnamed';
      l.bindPopup(`Lot: ${name}<br>${allowed}`);
    }
  }).addTo(map);
} else {
  const color = passColors[val] || '#ff0000';
  highlightLayer = L.geoJSON(geoData, {
    filter: f => {
      const passes = f.properties.pass;
      return Array.isArray(passes) ? passes.includes(val) : passes === val;
    },
    style: () => ({
      color: color,
      weight: 5,
      opacity: 1,
      fillColor: color,
      fillOpacity: 0.5
    }),
    onEachFeature: (f, l) => {
      const name = f.properties.tags?.name || f.properties['@id'] || 'Unnamed';
      l.bindPopup(`Allowed for: ${passNames[val]}<br>Name: ${name}`);
    }
  }).addTo(map);
}

if (highlightLayer && highlightLayer.getLayers().length) map.fitBounds(highlightLayer.getBounds());
});
</script>
</body>
</html>